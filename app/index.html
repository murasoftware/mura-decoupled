<!DOCTYPE html>
<html>
<head>
  <!-- This is include the main Mura.js lib -->
  <script src="http://localhost:8888/core/modules/v1/core_assets/js/mura.js"></script>

  <!-- This init's Mura.js and renders the content.  This could be another file -->
  <script>
    Mura.init({
        siteid: 'default',
        endpoint:'http://localhost:8888'
    });

    Mura(function(){
        Mura.loader()
        .loadcss(Mura.endpoint + '/core/modules/v1/core_assets/css/mura.10.min.css')
        .loadcss(Mura.endpoint + '/core/modules/v1/core_assets/css/mura.10.skin.css')
        .loadcss('assets/css/site.css');

        //This is also registered in the mura.config.json
        Mura.Module.Examplejs = Mura.UI.extend({
            renderClient: function() {
                this.context.mytitle = this.context.mytitle || "The 'Title' param has not been assigned";
                this.context.targetEl.innerHTML=`<h2>${Mura.escapeHTML(this.context.mytitle)}</h2>`;
                return this;
            }
        });

        function render(){
            let hash= location.hash || '#';
            
            function buildNav(container,parentid){
                container.html('');

                if(parentid=='00000000000000000000000000000000001'){
                    container.html('<li><a href="./#">Home</a></li>');
                }

                Mura.getFeed('content')
                .where()
                .prop('parentid').isEQ(parentid)
                .getQuery()
                .then(function(collection){
                collection.forEach(function(item){
                    container.append('<li><a href="#' + item.get('filename') + '">' + item.get('menutitle') + '</a></li>');
                });
                })
            }
            
            var query=Mura.getQueryStringParams();
        
            Mura.renderFilename(
                hash.split('#')[1],
                Mura.getQueryStringParams()
            ).then(function(content){

                Mura('.mura-html-queues').html(content.get('htmlheadqueue') + content.get('htmlfootqueue'));

                Mura.extend(Mura,Mura.extend(content.get('config')));
            
                if(query.display){
                    Mura('.mura-region-container[data-region="primarycontent"]').html(content.get('body'));
                } else if (query.doaction && query.doaction=='logout'){
                    alert(1)
                    Mura.logout().then( function(){
                        location.href="./";
                    });
                } else {
                    Mura('.mura-region-container').each(function(){
                    var item=Mura(this);
                    item.html(
                        content.renderDisplayRegion(
                        item.data('region')
                        )
                    );
                })
            }
           
            buildNav(
                Mura('.mura-primary-nav'),
                '00000000000000000000000000000000001'
            );

            Mura(document).processMarkup();

        });
        }

        render();

        Mura(window).on('hashchange', render);

    });
  </script>
</head>
<body>
    <div class="wrapper">
        <nav id="primary-nav">
        <ul class="mura-primary-nav"></ul>
        </nav>
        <div class="content">
            <div class="mura-region-container" data-region="primarycontent"></div>
        </div>
    </div>
    <footer>
        <!-- Create a component named "Footer" and it will render here-->
        <div class="mura-object" data-object="component" data-objectid="footer"></div>
    </footer>
     <div class="mura-html-queues"></div>
</body>
</html>